#!/usr/bin/env node
'use strict';

const fs = require('node:fs');
const path = require('node:path');

const root = path.resolve(__dirname, '..');

const mappings = [
	{
		source: path.join(root, 'packages', 'common', 'template-preprocess.ts'),
		target: path.join(root, 'packages', 'cli', 'src', 'shared-template-preprocess.ts')
	},
	{
		source: path.join(root, 'packages', 'common', 'template-flatten.ts'),
		target: path.join(root, 'packages', 'server', 'src', 'util', 'shared-template-flatten.ts')
	}
];

for (const { source, target } of mappings) {
	if (!fs.existsSync(source)) {
		throw new Error(`Missing shared source: ${source}`);
	}
	const content = fs.readFileSync(source, 'utf8');
	const header = '// AUTO-GENERATED by scripts/sync-shared-code.cjs. Do not edit directly.\n\n';
	fs.mkdirSync(path.dirname(target), { recursive: true });
	fs.writeFileSync(target, header + content);
	console.log(`Synced ${path.relative(root, target)}`);
}
